<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Песни</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body, html { font-family: 'Arial', sans-serif; height: 100%; width: 100%; background: #222; color: #fff; display: flex; justify-content: center; align-items: center; }
        .container { width: 80%; max-width: 900px; padding: 20px; background: #333; border-radius: 8px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5); }
        h1 { color: #fff; text-align: center; }
        select { width: 200px; margin: 10px; padding: 10px; }
        #lyrics { white-space: pre-wrap; font-family: 'Garamond', serif; background-color: #f8f8f8; padding: 15px; border-radius: 5px; max-height: 300px; overflow-y: auto; }
        .chord { font-weight: bold; color: indigo; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Песни</h1>
        <div>
            <select id="songSelect" onchange="displaySongData()"></select>
            <select id="keySelect" onchange="transposeSong()"></select>
            <div id="bpmDisplay"></div>
        </div>
        <div id="lyrics"></div>
        <div id="sourceLink"></div>
    </div>

    <script>
        let songsData = []; // Здесь будут храниться данные песен

        // Загружаем данные из JSON файла
        fetch('songs.json')
            .then(response => response.json())
            .then(data => {
                songsData = data;
                loadSongOptions();
            });

        // Загружаем песни в список
        function loadSongOptions() {
            const songSelect = document.getElementById('songSelect');
            songsData.forEach(song => {
                const option = document.createElement('option');
                option.value = song.title;
                option.textContent = song.title;
                songSelect.appendChild(option);
            });
            displaySongData();
        }

        // Отображаем данные песни
        function displaySongData() {
            const selectedSongTitle = document.getElementById('songSelect').value;
            const song = songsData.find(s => s.title === selectedSongTitle);

            if (song) {
                document.getElementById('lyrics').innerHTML = song.lyricsAndChords
                    .replace(/([A-GH][#b]?)([a-z0-9]*)/g, '<span class="chord">$&</span>');
                document.getElementById('sourceLink').innerHTML = `<a href="${song.sourceLink}" target="_blank">Источник</a>`;
                document.getElementById('bpmDisplay').innerText = `BPM: ${song.bpm}`;
                loadKeyOptions(song.originalKey);
            }
        }

        // Загружаем доступные тональности
        function loadKeyOptions(originalKey) {
            const keySelect = document.getElementById('keySelect');
            const keys = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
            keySelect.innerHTML = '';
            keys.forEach(key => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = key;
                if (key === originalKey) option.selected = true;
                keySelect.appendChild(option);
            });
        }

        // Транспонирование аккордов
        function transposeSong() {
            const selectedSongTitle = document.getElementById('songSelect').value;
            const song = songsData.find(s => s.title === selectedSongTitle);
            const newKey = document.getElementById('keySelect').value;

            if (song) {
                const transposedLyrics = transposeChords(song.lyricsAndChords, song.originalKey, newKey);
                document.getElementById('lyrics').innerHTML = transposedLyrics
                    .replace(/([A-GH][#b]?)([a-z0-9]*)/g, '<span class="chord">$&</span>');
            }
        }

        // Функция для транспонирования аккордов
        function transposeChords(lyrics, originalKey, newKey) {
            const chords = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];
            const transposition = getTransposition(originalKey, newKey);

            return lyrics.split('\n').map(line => {
                return line.split(' ').map(word => {
                    const chord = chords.find(chord => word.startsWith(chord));
                    if (chord) {
                        const chordIndex = chords.indexOf(chord);
                        const newChordIndex = (chordIndex + transposition + chords.length) % chords.length;
                        return word.replace(chord, chords[newChordIndex]);
                    }
                    return word;
                }).join(' ');
            }).join('\n');
        }

        // Определяем шаг транспонирования
        function getTransposition(originalKey, newKey) {
            const majorKeys = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];
            const originalIndex = majorKeys.indexOf(originalKey);
            const newIndex = majorKeys.indexOf(newKey);
            return newIndex - originalIndex;
        }
    </script>
</body>
</html>
